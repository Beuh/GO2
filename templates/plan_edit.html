{% import 'plan_icon.html' as plan_icon %}
{% macro plan_edit(plan, section_info, show_date=False, show_member=False, show_band=False, show_gig_name=False, show_section=True) -%}
<tr>
    {% if show_gig_name %}
        <td class="plan-cell">
            <a href="gig_info.html?gk={{ plan.key.parent().urlsafe() }}" >{{ plan.key.parent().get().title|e }}</a>
        </td>
    {% endif %}
    {% if show_date %}
        <td class="plan-cell" width="20%">
            {{ plan.key.parent().get().date|e }}
        </td>
    {% endif %}
    {% if show_member %}
        <td class="plan-cell" width="20%">
             <a href='/member_info.html?mk={{plan.member.urlsafe()}}'>{{ plan.member.get().name }}</a>
        </td>
    {% endif %}
    {% if show_band %}
        <td class="plan-cell" width="20%">
            <a href="band_info.html?bk={{ plan.key.parent().get().key.parent().urlsafe()}}">
             {{ plan.key.parent().get().key.parent().get().name|e }}</a>
        </td>
    {% endif %}
    <td class="plan-cell" width="10%">
        {% if plan.member == the_user.key or nav_info['is_superuser'] %}
            {{ plan_icon.icon_button(plan) }}
        {% else %}
            {{ plan_icon.icon(plan.value) }}
        {% endif %}
    </td>
    <td class="plan-cell" style="min-width: 200px">
        {% if plan.member == the_user.key or nav_info['is_superuser'] %}    
            <div class="form-group plan-comment-input">
                <input type="text" id="c-{{plan.key.urlsafe()}}" class="form-control" value="{{plan.comment}}" onchange="update_comment('{{plan.key.urlsafe()}}')">
            </div>
        {% else %}
            {{plan.comment}}
        {% endif %}
    </td>
    {% if show_section %}
        <td class="plan-cell" style="min-width: 100px">
            {% if get_the_section_keys %}
                {% set the_section_keys = get_the_section_keys(plan.key.parent().get().key.parent()) %}
            {% endif %}
            {% if the_section_keys and the_section_keys|length > 1 and (plan.member == the_user.key or nav_info['is_superuser'])%}
            <div class="form-group plan-comment-input">
                <select class="form-control" id="sel-{{plan.key.urlsafe()}}" onchange="option_select('{{plan.key.urlsafe()}}')">
                {% for section_key in the_section_keys %}
                    <option
                        {% if section_key == plan.section %}
                            selected
                        {% endif %}
                        id="{{section_key.urlsafe()}}"
                    >{{ section_key.get().name }}</option>
                {% endfor %}
                </select>
            </div>
            {% endif %}
        </td>
    {% endif %}
</tr>
{%- endmacro %}
