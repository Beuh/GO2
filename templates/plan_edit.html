{% import 'plan_icon.html' as plan_icon %}
{% macro plan_edit(plan_info, show_date=False, show_member=False, show_band=False, show_gig_name=False, show_section=True) -%}
{% set the_gig_key = plan_info['the_gig_key'] %}
{% set the_plan_key = plan_info['the_plan_key'] %}
{% set the_member_key = plan_info['the_member_key'] %}
{% set the_band_key = plan_info['the_band_key'] %}
{% set the_assoc = plan_info['the_assoc'] %}
<tr>
    {% if show_gig_name %}
        <td class="plan-cell">
            <a href="gig_info.html?gk={{ the_gig_key.urlsafe() }}" >{{ the_gig_key.get().title|e }}</a>
        </td>
    {% endif %}
    {% if show_date %}
        <td class="plan-cell" width="20%">
            {{ the_gig_key.get().date|e }}
        </td>
    {% endif %}
    {% if show_member %}
        <td class="plan-cell" width="20%">
             <a href='/member_info.html?mk={{the_member_key.urlsafe()}}'>{{ the_member_key.get().name }}</a>
        </td>
    {% endif %}
    {% if show_band %}
        <td class="plan-cell" width="20%">
            <a href="band_info.html?bk={{ the_band_key.urlsafe()}}">
             {{ the_band_key.get().name|e }}</a>
        </td>
    {% endif %}
    <td class="plan-cell" width="10%">
        {% if the_member_key == the_user.key or the_user_is_superuser %}
            {{ plan_icon.icon_button(the_plan_key.get()) }}
        {% else %}
            {{ plan_icon.icon(the_plan_key.get().value) }}
        {% endif %}
    </td>
    <td class="plan-cell" style="min-width: 200px">
        {% if the_member_key == the_user.key or the_user_is_superuser %}    
            <div class="form-group plan-comment-input">
                <input type="text" id="c-{{the_plan_key.urlsafe()}}" class="form-control" value="{{the_plan_key.get().comment}}" onchange="update_comment('{{the_plan_key.urlsafe()}}')">
            </div>
        {% else %}
            {{the_plan_key.get().comment}}
        {% endif %}
    </td>
    {% if show_section and the_assoc and the_assoc.is_multisectional %}
        <td class="plan-cell" style="min-width: 100px">
            {% if get_the_section_keys %}
                {% set the_section_keys = get_the_section_keys(the_band_key) %}
            {% endif %}
            {% set the_section_keys = the_band_key.get().sections %}
            {% if the_section_keys and the_section_keys|length > 1 and (the_plan_key.get().member == the_user.key or the_user_is_superuser)%}
            <div class="form-group plan-comment-input">
                <select class="form-control" id="sel-{{the_plan_key.urlsafe()}}" onchange="option_select('{{the_plan_key.urlsafe()}}')">
                {% for section_key in the_section_keys %}
                    {% if section_key %}
                        <option
                            {% if section_key == the_plan_key.get().section %}
                                selected
                            {% endif %}
                            id="{{section_key.urlsafe()}}"
                        >{{ section_key.get().name }}</option>
                    {% endif %}
                {% endfor %}
                </select>
            </div>
            {% endif %}
        </td>
    {% endif %}
</tr>
{%- endmacro %}
